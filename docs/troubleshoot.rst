.. Troubleshooting

Troubleshooting
***************

Troubleshooting the Infrastructure:
===================================

This guide will not cover troubleshooting the infrastructure. Refer to the following
guides for troubleshooting ``CoreOS``, its init system, and the 3rd party applications
on the stack:

**RethinkDB**
- http://rethinkdb.com/docs/

**NSQ**
- https://www.nsq.io

**CoreOS**
- https://coreos.com/docs/

Troubleshooting the IRCDD Server:
=================================

First, Identify the problem. Check the logs for hint if client
behaviour is not clear enough. If running as a service on ``CoreOS``
check the service's status as well. Below are some of the most common
problems:

Server is stuck on `[ircdd] waiting for confd to create initial ircdd configuration`:
-------------------------------------------------------------------------------------

This means that ``Confd`` is not finding the ``ETCD`` entries of the services that
``IRCDD`` needs to run (``RethinkDB``, ``NSQ``). Check if those services are running 
and reachable. If that is not the problem, check if ``ETCD`` has entries for those
services by running:

.. code-block:: shell-session

    etcdctl ls --recursive /

Server is dropping requests due to unreachable ``RethinkDB``/``NSQ``:
---------------------------------------------------------------------

Check if the services are running and reachable. Check if the configuration
file generated by ``Confd`` has the correct service details.

Server is failing for unknown reasons:
--------------------------------------

In the case that the logfile cannot shed some light on the issue, it is possible to run
the ``IRCDD`` instance in an interactive ``Docker`` container. Kill all ``IRCDD`` instances,
ensure that all other services are working as intended, and start an interactive container:

.. code-block:: shell-session

    docker run \
          -p 5799:5799 \
          -e HOST_IP=${COREOS_PUBLIC_IPV4} \
          -e ETCD_PORT=4001 \
          -e NSQD_PORT=4150 \
          -e INSTANCE_NAME=ircdd-%i \
          --name ircdd-%i \
          kzvezdarov/ircdd-confd \
          bash

This will start ``IRCDD``'s ``Docker`` container and log you in a ``bash`` session.
Manually go through the startup process of the server by invoking ``confd-watch-ircdd``
and monitoring the results. Verify that the container has the appropriate files in 
``/etc/confd``, ``/etc/ircdd``, and ``/data`` (see ``scripts/containers/ircdd-confd``
for the list of expected files).
